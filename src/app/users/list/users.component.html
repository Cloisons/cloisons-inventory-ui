<div class="content-wrapper pb-0">
  <header class="page-header flex-wrap">
    <div class="page-title">
      <h1 class="mb-0">User Management</h1>
      <p class="text-sub">Manage your users</p>
    </div>
    <nav class="breadcrumb-nav" aria-label="Breadcrumb">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a routerLink="/dashboard">Dashboard</a></li>
        <li class="breadcrumb-item active" aria-current="page">Users</li>
      </ol>
    </nav>
  </header>

  <main class="row">
    <div class="col-xl-12 grid-margin stretch-card">
      <section class="card" role="region" aria-labelledby="users-section-title">
        <div class="card-body px-0 overflow-auto">
          <div class="title-and-button mb-3">
            <h4 class="card-title pl-0">Users list</h4>
            <div class="header-actions">
              <div class="search-box">
                <input
                  type="text"
                  class="form-control search-input"
                  placeholder="Search users..."
                  [(ngModel)]="query"
                  (input)="onSearchInput($event)"
                  (keypress)="onSearchKeyPress($event)"
                  aria-label="Search users"
                />
                <i class="mdi mdi-magnify search-icon" [class.spinning]="isSearching" *ngIf="!query"></i>
                <i class="mdi mdi-close search-clear" *ngIf="query && !isLoading" (click)="clearSearch()" title="Clear search"></i>
              </div>
              <a routerLink="/users/add" class="btn btn btn-primary btn-primary-md btn-with-icon">
                <i class="mdi mdi-account-plus mr-0"></i>
                Add User
              </a>
            </div>
          </div>

          <!-- Info message about super admin exclusion -->


          <div class="alert alert-info mx-4 mb-3" role="alert">
    
  <i class="mdi mdi-information-outline me-2" aria-hidden="true"></i>
              <div>
                <strong>Note:</strong> Super admin users are not displayed in this list for security reasons.
              </div>
       
          </div>



          <div *ngIf="errorMessage && !isLoading" class="alert alert-danger mx-4" role="alert">
            <div class="d-flex align-items-center">
              <i class="mdi mdi-alert-circle me-2" aria-hidden="true"></i>
              <div>
                <h4 class="alert-heading mb-1">Error Loading Users</h4>
                <p class="mb-0">{{ errorMessage }}</p>
              </div>
            </div>
          </div>

          <div *ngIf="isLoading" class="text-center py-5" role="status" aria-live="polite">
            <div class="spinner-border text-primary" role="status" aria-hidden="true">
              <span class="visually-hidden">Loading users...</span>
            </div>
            <p class="mt-3 text-muted">Loading users...</p>
          </div>

          <div *ngIf="!isLoading" class="table-responsive">
            <table class="table table-common">
              <thead class="bg-light">
                <tr>
                  <th>#</th>
                  <th>Name</th>
                  <th>Email</th>
                  <th>Role</th>
                  <th>Status</th>
                  <th>Created</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let user of users; trackBy: trackById; let i = index">
                  <td class="text-muted">{{ (page - 1) * limit + i + 1 }}</td>
                  <td>
                    <div class="d-flex align-items-center username-table">
                      <div class="avatar-sm bg-primary text-white rounded-circle d-flex align-items-center justify-content-center me-3">
                        {{ user.firstName.charAt(0) }}{{ user.lastName.charAt(0) }}
                      </div>
                      <div>
                        <div class="fw-medium text-dark">{{ user.firstName }} {{ user.lastName }}</div>
                        <small class="text-muted">ID: {{ user._id }}</small>
                      </div>
                    </div>
                  </td>
                  <td>
                    <div class="d-flex align-items-center email-table">
                      <i class="mdi mdi-email-outline me-2 text-muted"></i>
                      <span class="text-dark">{{ user.email }}</span>
                    </div>
                  </td>
                  <td>
                    <span class="badge" [ngClass]="getRoleBadgeClass(user.role)">
                      <i class="mdi mdi-account me-1"></i>
                      {{ getRoleDisplayName(user.role) }}
                    </span>
                  </td>
                  <td>
                    <span class="badge" [ngClass]="getStatusBadgeClass(user)">
                      <i class="mdi" [ngClass]="getStatusIcon(user)"></i>
                      {{ getStatusText(user) }}
                    </span>
                    <div *ngIf="user.failedAttempts && user.failedAttempts > 0 && user.role !== 'superAdmin'" class="small text-muted mt-1">
                      Failed attempts: {{ user.failedAttempts }}
                    </div>
                    <div *ngIf="user.role === 'superAdmin'" class="small text-muted mt-1">
                      Cannot be locked
                    </div>
                  </td>
                  <td>
                    <div class="d-flex flex-column">
                      <span class="text-dark">{{ user.createdAt | date:'MMM dd, yyyy' }}</span>
                      <small class="text-muted">{{ user.createdAt | date:'h:mm a' }}</small>
                    </div>
                  </td>
                  <td>
                    <div class="table-actions">
                      <a
                        class="mdl-button mdl-js-button mdl-button--icon mdl-button--colored"
                        [routerLink]="['/users', user._id, 'edit']"
                        title="Edit"
                        aria-label="Edit user"
                      >
                        <i class="mdi mdi-pencil"></i>
                      </a>
                      <button
                        class="mdl-button mdl-js-button mdl-button--icon mdl-button--colored"
                        (click)="user.isLocked ? onUnlock(user) : onLock(user)"
                        [title]="user.isLocked ? 'Unlock Account' : 'Lock Account'"
                        [attr.aria-label]="user.isLocked ? 'Unlock user account' : 'Lock user account'"
                        *ngIf="isSuperAdmin && user.role !== 'superAdmin'"
                      >
                        <i class="mdi" [ngClass]="user.isLocked ? 'mdi-lock-open' : 'mdi-lock'"></i>
                      </button>
                      <button
                        class="mdl-button mdl-js-button mdl-button--icon mdl-button--colored"
                        (click)="onDelete(user)"
                        title="Delete"
                        aria-label="Delete user"
                        *ngIf="isSuperAdmin"
                      >
                        <i class="mdi mdi-delete"></i>
                      </button>
                    </div>
                  </td>
                </tr>
                <tr *ngIf="users.length === 0">
                  <td colspan="7" class="text-center py-5">
                    <div class="empty-state">
                      <i class="mdi mdi-account-off-outline mb-3" style="font-size: 3rem; color: #6c757d;" aria-hidden="true"></i>
                      <h5 class="text-muted">No users found</h5>
                      <p class="text-muted mb-0">There are no regular users to display.</p>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <div *ngIf="!isLoading && totalPages > 1" class="pagination-block">
            <span class="pagecount">{{ ((page - 1) * limit) + 1 }}-{{ getMin(page * limit, total) }} of {{ total }} users</span>
            <ul class="pagination">
              <li [class.disabled]="page === 1">
                <a href="#" (click)="goTo(page - 1); $event.preventDefault()" [class.disabled]="page === 1">&laquo;</a>
              </li>
              <li *ngFor="let p of pageRange; trackBy: trackByPageNumber" [class.active]="p === page">
                <a href="#" (click)="goTo(p); $event.preventDefault()">{{ p }}</a>
              </li>
              <li [class.disabled]="page === totalPages">
                <a href="#" (click)="goTo(page + 1); $event.preventDefault()" [class.disabled]="page === totalPages">&raquo;</a>
              </li>
            </ul>
          </div>

        </div>
      </section>
    </div>
  </main>
</div>

