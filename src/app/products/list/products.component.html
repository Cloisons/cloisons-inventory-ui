<div class="content-wrapper pb-0">
  <header class="page-header flex-wrap">
    <div class="page-title">
      <h1 class="mb-0">Product Management</h1>
      <p class="text-sub">Manage your products</p>
    </div>
    <nav class="breadcrumb-nav" aria-label="Breadcrumb">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a routerLink="/dashboard">Dashboard</a></li>
        <li class="breadcrumb-item active" aria-current="page">Products</li>
      </ol>
    </nav>
  </header>

  <main class="row">
    <div class="col-xl-12 grid-margin stretch-card">
      <section class="card" role="region" aria-labelledby="products-section-title">
        <div class="card-body px-0 overflow-auto">
          <div class="title-and-button mb-0">
            <h4 class="card-title pl-0">Products list</h4>
            <div class="header-actions">
              <div class="search-box">
                <input
                  type="text"
                  class="form-control search-input"
                  placeholder="Search products..."
                  [(ngModel)]="query"
                  (input)="onSearchInput($event)"
                  (keypress)="onSearchKeyPress($event)"
                  aria-label="Search products"
                />
                <i class="mdi mdi-magnify search-icon" [class.spinning]="isSearching" *ngIf="!query"></i>
                <i class="mdi mdi-close search-clear" *ngIf="query && !isLoading" (click)="clearSearch()" title="Clear search"></i>
              </div>
              <a routerLink="/products/add" class="btn btn btn-primary btn-primary-md btn-with-icon">
                <i class="mdi mdi-package-variant-plus mr-0"></i>
                Add Product
              </a>
            </div>
          </div>

          <div *ngIf="errorMessage && !isLoading" class="alert alert-danger mx-4" role="alert">
            <div class="d-flex align-items-center">
              <i class="mdi mdi-alert-circle me-2" aria-hidden="true"></i>
              <div>
                <h4 class="alert-heading mb-1">Error Loading Products</h4>
                <p class="mb-0">{{ errorMessage }}</p>
              </div>
            </div>
          </div>

          <div *ngIf="isLoading" class="text-center py-5" role="status" aria-live="polite">
            <div class="spinner-border text-primary" role="status" aria-hidden="true">
              <span class="visually-hidden">Loading products...</span>
            </div>
            <p class="mt-3 text-muted">Loading products...</p>
          </div>

          <div *ngIf="!isLoading" class="table-responsive">
            <table class="table table-common">
              <thead class="bg-light">
                <tr>
                  <th>Product name</th>
                  <th>Description</th>
                  <th>Items count</th>
                  <th>Created</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let p of products; trackBy: trackById">
                  <td>{{ p.productName }}</td>
                  <td>{{ p.productDescription || 'â€”' }}</td>
                  <td>{{ p.items.length || 0 }}</td>
                  <td>{{ p.createdAt | date: 'medium' }}</td>
                  <td>
                    <div class="table-actions">
                      <a
                        class="mdl-button mdl-js-button mdl-button--icon mdl-button--colored"
                        [routerLink]="['/products', p._id, 'edit']"
                        title="Edit"
                        aria-label="Edit product"
                      >
                        <i class="mdi mdi-pencil"></i>
                      </a>
                      <button
                        class="mdl-button mdl-js-button mdl-button--icon mdl-button--colored"
                        (click)="onDelete(p)"
                        title="Delete"
                        aria-label="Delete product"
                      >
                        <i class="mdi mdi-delete"></i>
                      </button>
                    </div>
                  </td>
                </tr>
                <tr *ngIf="products.length === 0">
                  <td colspan="5" class="text-center py-5">
                    <div class="empty-state">
                      <i class="mdi mdi-package-variant mb-3" style="font-size: 3rem; color: #6c757d;" aria-hidden="true"></i>
                      <h5 class="text-muted">No products found</h5>
                      <p class="text-muted mb-0">Try adjusting your search or add a new product.</p>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <div *ngIf="!isLoading && totalPages > 1" class="pagination-block">
            <span class="pagecount">{{ ((page - 1) * limit) + 1 }}-{{ getMin(page * limit, total) }} of {{ total }} products</span>
            <ul class="pagination">
              <li [class.disabled]="page === 1">
                <a href="#" (click)="goTo(page - 1); $event.preventDefault()" [class.disabled]="page === 1">&laquo;</a>
              </li>
              <li *ngFor="let p of pageRange; trackBy: trackByPageNumber" [class.active]="p === page">
                <a href="#" (click)="goTo(p); $event.preventDefault()">{{ p }}</a>
              </li>
              <li [class.disabled]="page === totalPages">
                <a href="#" (click)="goTo(page + 1); $event.preventDefault()" [class.disabled]="page === totalPages">&raquo;</a>
              </li>
            </ul>
          </div>

        </div>
      </section>
    </div>
  </main>
</div>


