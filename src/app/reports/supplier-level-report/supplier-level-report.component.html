<div class="supplier-level-report">
  <header class="page-header">
    <div class="page-title">
      <h3>Supplier Level Report</h3>
      <span class="text-sub">Comprehensive supplier performance analysis and metrics</span>
    </div>
    <nav class="breadcrumb-nav" aria-label="Breadcrumb">
      <ol class="breadcrumb">
        <li class="breadcrumb-item">
          <a routerLink="/dashboard" aria-label="Go to Dashboard">Dashboard</a>
        </li>
        <li class="breadcrumb-item">
          <a routerLink="/reports" aria-label="Go to Reports">Reports</a>
        </li>
        <li class="breadcrumb-item active" aria-current="page">Supplier Level Report</li>
      </ol>
    </nav>
  </header>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <div class="spinner-border" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p>Loading supplier level report...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !loading" class="alert alert-danger" role="alert">
    <i class="mdi mdi-alert-circle me-2"></i>
    {{ error }}
    <button type="button" class="btn btn-sm btn-outline-danger ms-3" (click)="loadReport()">
      <i class="mdi mdi-refresh me-1"></i>Retry
    </button>
  </div>

  <!-- Report Content -->
  <div *ngIf="!loading && !error">
    <!-- Header Actions -->
    <div class="report-header">
      <div class="header-actions">
        <button class="refresh-button" (click)="refreshReport()" [disabled]="loading">
          <i class="mdi mdi-refresh" [class.spinning]="loading"></i>
          Refresh
        </button>
        <div class="export-dropdown">
          <button class="export-button">
            <i class="mdi mdi-download"></i>
            Export
          </button>
          <div class="export-menu">
            <button (click)="exportReport('pdf')">Export as PDF</button>
            <button (click)="exportReport('excel')">Export as Excel</button>
            <button (click)="exportReport('csv')">Export as CSV</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Filters Section -->
    <div class="filters-section">
      <div class="filters-row">
        <div class="search-box">
          <i class="mdi mdi-magnify"></i>
          <input
            type="text"
            placeholder="Search suppliers..."
            [(ngModel)]="searchTerm"
            (keyup.enter)="onSearch()"
          />
        </div>
        <select
          [(ngModel)]="selectedCountry"
          (change)="onFilterChange()"
        >
          <option value="">All Countries</option>
          <option *ngFor="let country of countries" [value]="country">
            {{ country }}
          </option>
        </select>
        <input
          type="date"
          placeholder="Start Date"
          [(ngModel)]="startDate"
          (change)="onFilterChange()"
        />
        <input
          type="date"
          placeholder="End Date"
          [(ngModel)]="endDate"
          (change)="onFilterChange()"
        />
        <select
          [(ngModel)]="itemsPerPage"
          (change)="onItemsPerPageChange()"
        >
          <option value="10">10 per page</option>
          <option value="25">25 per page</option>
          <option value="50">50 per page</option>
          <option value="100">100 per page</option>
        </select>
        <!-- <button
          type="button"
          class="btn btn-outline-secondary"
          (click)="clearFilters()"
          title="Clear all filters"
        >
          <i class="mdi mdi-filter-remove"></i> Clear
        </button> -->
      </div>
        <div class="row mt-3">
          <div class="col-12">
            <button
              type="button"
              class="btn btn-primary me-2"
              (click)="onSearch()"
            >
              <i class="mdi mdi-magnify me-1"></i>Search
            </button>
            <!-- <div class="btn-group" role="group">
              <button
                type="button"
                class="btn btn-outline-success"
                (click)="exportReport('pdf')"
                title="Export as PDF"
              >
                <i class="mdi mdi-file-pdf-box me-1"></i>PDF
              </button>
              <button
                type="button"
                class="btn btn-outline-success"
                (click)="exportReport('excel')"
                title="Export as Excel"
              >
                <i class="mdi mdi-file-excel-box me-1"></i>Excel
              </button>
              <button
                type="button"
                class="btn btn-outline-success"
                (click)="exportReport('csv')"
                title="Export as CSV"
              >
                <i class="mdi mdi-file-delimited me-1"></i>CSV
              </button>
            </div> -->
          </div>
        </div>
      </div>
    </div>

    <!-- Analytics Summary -->
    <div *ngIf="reportData?.analytics" class="analytics-section">
      <div class="analytics-cards">
        <div class="analytics-card">
          <div class="card-icon">
            <i class="mdi mdi-account-group"></i>
          </div>
          <div class="card-content">
            <h3>{{ reportData?.analytics?.totalSuppliers || 0 }}</h3>
            <p>Total Suppliers</p>
          </div>
        </div>
        <div class="analytics-card">
          <div class="card-icon info">
            <i class="mdi mdi-package-variant"></i>
          </div>
          <div class="card-content">
            <h3>{{ reportData?.analytics?.totalItems || 0 }}</h3>
            <p>Total Items</p>
          </div>
        </div>
        <div class="analytics-card">
          <div class="card-icon success">
            <i class="mdi mdi-currency-usd"></i>
          </div>
          <div class="card-content">
            <h3>{{ formatCurrency(reportData?.analytics?.totalValue || 0) }}</h3>
            <p>Total Value</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Performance Metrics -->
    <div *ngIf="reportData?.analytics" class="row mb-4">
      <div class="col-md-6">
        <div class="card">
          <div class="card-header">
            <h6 class="card-title mb-0">Performance Breakdown</h6>
          </div>
          <div class="card-body">
            <div *ngFor="let performance of reportData?.analytics?.performanceBreakdown || []" class="d-flex justify-content-between align-items-center mb-2">
              <span>{{ performance.category }}</span>
              <div class="d-flex align-items-center">
                <div class="progress me-2" style="width: 100px; height: 8px;">
                  <div class="progress-bar" [style.width.%]="performance.percentage"></div>
                </div>
                <span class="text-muted">{{ performance.count }} ({{ formatPercentage(performance.percentage) }})</span>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-6">
        <div class="card">
          <div class="card-header">
            <h6 class="card-title mb-0">Country Distribution</h6>
          </div>
          <div class="card-body">
            <div *ngFor="let country of reportData?.analytics?.countryBreakdown || []" class="d-flex justify-content-between align-items-center mb-2">
              <span>{{ country.country }}</span>
              <div class="d-flex align-items-center">
                <div class="progress me-2" style="width: 100px; height: 8px;">
                  <div class="progress-bar bg-info" [style.width.%]="country.percentage"></div>
                </div>
                <span class="text-muted">{{ country.count }} ({{ formatPercentage(country.percentage) }})</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Suppliers Table -->
    <div class="table-section">
      <div class="table-container">
        <div *ngIf="!hasData" class="empty-state">
          <i class="mdi mdi-truck-delivery-outline"></i>
          <h5>No suppliers found</h5>
          <p>Try adjusting your filters or search criteria.</p>
        </div>

        <div *ngIf="hasData">
          <table class="data-table">
            <thead>
              <tr>
                <th>Supplier</th>
                <th>Contact</th>
                <th>Country</th>
                <th>Items</th>
                <th>Total Value</th>
                <th>Last Order</th>
               
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let supplier of reportData?.suppliers" class="data-row">
                <td>
                  <div class="supplier-name-cell">
                    <div class="supplier-info">
                      <div class="supplier-name">{{ supplier.supplierName }}</div>
                      <div class="supplier-email">{{ supplier.email }}</div>
                    </div>
                  </div>
                </td>
                <td>
                  <div>
                    <div>{{ supplier.contactPerson }}</div>
                    <small class="text-muted">{{ supplier.phoneNumber }}</small>
                  </div>
                </td>
                <td>
                  <span class="badge bg-light text-dark">{{ supplier.countryOfOrigin }}</span>
                </td>
                <td>
                  <span class="badge bg-primary">{{ supplier.totalItems }}</span>
                </td>
                <td class="value-cell">
                  {{ formatCurrency(supplier.totalValue) }}
                </td>
                <td>
                  <div class="small">{{ formatDate(supplier.lastOrderDate) }}</div>
                  <div class="text-muted">{{ supplier.totalOrders }} orders</div>
                </td>
               
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Pagination -->
    <div *ngIf="hasData && totalPages > 1" class="pagination-section">
      <div class="pagination-info">
        Page {{ currentPage }} of {{ totalPages }}
      </div>
      <div class="pagination-controls">
        <button 
          class="page-btn" 
          (click)="onPageChange(currentPage - 1)" 
          [disabled]="currentPage === 1"
          title="Previous page"
        >
          <i class="mdi mdi-chevron-left"></i>
        </button>
        <div class="page-numbers">
          <button 
            *ngFor="let page of [].constructor(totalPages); let i = index"
            class="page-btn" 
            [class.active]="currentPage === i + 1"
            (click)="onPageChange(i + 1)"
            [title]="'Page ' + (i + 1)"
          >
            {{ i + 1 }}
          </button>
        </div>
        <button 
          class="page-btn" 
          (click)="onPageChange(currentPage + 1)" 
          [disabled]="currentPage === totalPages"
          title="Next page"
        >
          <i class="mdi mdi-chevron-right"></i>
        </button>
      </div>
    </div>
  </div>
